---
- hosts: server
  become: yes
  become_method: sudo
  environment:
    http_proxy: "{{ http_proxy | default() }}"
    https_proxy: "{{ https_proxy | default() }}"
    no_proxy: "{{ no_proxy | default() }}"

  pre_tasks:
  roles:
    - reallyenglish.hosts
    - ansible-role-rabbitmq
  vars:
    hosts_map:
      "192.168.21.201":
        - server1.virtualbox.reallyenglish.com
      "192.168.21.202":
        - server2.virtualbox.reallyenglish.com

    rabbitmq_plugins:
      - rabbitmq_management
    rabbitmq_env:
      RABBITMQ_NODE_IP_ADDRESS: "{{ ansible_em1.ipv4[0].address }}"
      RABBITMQ_USE_LONGNAME: "true"
